(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/person/user"],{"0907":function(e,t,n){"use strict";var o;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var i=function(){var e=this,t=e.$createElement;e._self._c},a=[]},"0ec1":function(e,t,n){},"3a87":function(e,t,n){"use strict";n.r(t);var o=n("0907"),i=n("f1fa");for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("b210");var s,c=n("f0c5"),l=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);t["default"]=l.exports},"8a1f":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){Promise.all([n.e("common/vendor"),n.e("components/uni-popup/uni-popup")]).then(function(){return resolve(n("f02b"))}.bind(null,n)).catch(n.oe)},i={components:{uniPopup:o},data:function(){return{img:"",user_info:{school_list:{school_name:""},display_list:{mobile:""}},token:"",location:[],sex:[{name:"男",id:1},{name:"女",id:0}],update:!0,grade:[],school:[],type:"",newName:"",newEmail:""}},onLoad:function(){e.getStorageSync("userInfo").token&&(this.token=e.getStorageSync("userInfo").token,this.type=e.getStorageSync("type")),this.type=e.getStorageSync("type"),this.get_grade(),this.getuserinfo(),this.get_location_list()},onShow:function(){this.update?this.getuserinfo():this.update=!0},methods:{pageToChangePass:function(){e.navigateTo({url:"/pages/person/forgetPassword"})},changeEmail:function(){this.newEmail=this.user_info.email,this.$refs.botpopups.open()},newEmailconfirmClick:function(){var t=this;if(console.log("changeEmail",this.newEmail),this.$refs.botpopups.close(),this.newEmail)if(this.newEmail!=this.user_info.email){var n,o={email:this.newEmail,token:this.token};n=4==this.type?this.$api.save_email(o):this.$api.save_teacher_email(o),n.then((function(n){console.log(n),200==n.code?(e.showToast({title:"修改成功"}),setTimeout((function(){t.newName="",t.getuserinfo()}),1e3)):e.showToast({title:n.msg,icon:"none"})}))}else e.showToast({title:"新邮箱不可与原邮箱一致！",icon:"none"});else e.showToast({title:"不能为空！",icon:"none"})},confirmClick:function(){var t=this;if(this.$refs.botpopup.close(),this.newName){var n,o={true_name:this.newName,token:this.token};n=4==this.type?this.$api.change_user_info(o):this.$api.change_teacher_info(o),n.then((function(n){console.log(n),200==n.code?(e.showToast({title:"修改成功"}),setTimeout((function(){t.newName="",t.getuserinfo()}),1e3)):e.showToast({title:n.msg,icon:"none"})}))}else e.showToast({title:"不能为空！",icon:"none"})},newNameChange:function(e){var t=e.detail.value;this.newName=t},newEmailChange:function(e){var t=e.detail.value;this.newEmail=t},cancleClick:function(){this.newName="",this.$refs.botpopup.close()},newEmailcancleClick:function(){this.newEmail="",this.$refs.botpopups.close()},checkimg:function(){var t=this;this.update=!1,e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(n){var o=t;console.log(n.tempFilePaths),o.img=n.tempFilePaths[0];var i="";i=4==o.type?o.$api.url+"user/update_avatar/":o.$api.url+"teacher/update_avatar/",e.uploadFile({url:i,filePath:o.img,name:"file",formData:{token:o.token},success:function(e){console.log("返回",e.data)}})}})},touser:function(t){console.log(t),e.navigateTo({url:t})},get_location_list:function(){var e=this;this.$api.get_location_list({token:this.token}).then((function(t){console.log(t),e.location=t.data}))},getschool:function(){var e,t,n=this,o={province_id:null===(e=this.user_info)||void 0===e||null===(t=e.school_list)||void 0===t?void 0:t.province_id,city_id:this.user_info.school_list.city_id,area_id:this.user_info.school_list.area_id,token:this.token};this.$api.get_school(o).then((function(e){console.log(e),0==e.data.length?n.school=[{name:"该省市区没有学校"}]:n.school=e.data}))},get_grade:function(){var e=this;this.$api.get_grade({token:this.token}).then((function(t){console.log(t),e.grade=t.data.grade_list}))},getuserinfo:function(){var t=this;4==e.getStorageSync("type")?this.$api.get_user_info({token:this.token}).then((function(e){console.log(e),t.user_info=e.data,t.img=e.data.avatar,t.newName=e.data.true_name,t.newEmail=e.data.email})):this.$api.get_teacher_info({token:this.token}).then((function(e){console.log(e),t.user_info=e.data,t.img=e.data.avatar,t.newName=e.data.true_name,t.newEmail=e.data.email}))},changeGrade:function(t){var n=this;if(4==e.getStorageSync("type"))var o=this.$api.change_grade({token:this.token,grade_ids:this.grade[t.detail.value].grade_id});else o=this.$api.change_teacher_info({token:this.token,grade_ids:this.grade[t.detail.value].grade_id});o.then((function(t){console.log(t),200!=t.code&&e.showToast({title:t.msg,icon:"none"}),n.getuserinfo()}))},changesc:function(t){var n=this;if(4==e.getStorageSync("type"))var o=this.$api.change_user_info({token:this.token,school_id:this.school[t.detail.value].id});else o=this.$api.change_teacher_info({token:this.token,school_id:this.school[t.detail.value].id});o.then((function(t){console.log(t),200!=t.code&&e.showToast({title:t.msg,icon:"none"}),n.getuserinfo()}))},bindChange:function(t){var n=this;console.log(t);var o=t.detail.code;if(4==e.getStorageSync("type"))var i=this.$api.change_user_info({token:this.token,region:o.toString()});else i=this.$api.change_teacher_info({token:this.token,region:o.toString()});i.then((function(e){console.log(e),n.getuserinfo()}))},bindChange2:function(t){var n=this;console.log(t);var o=this.sex[t.detail.value].id;if(4==e.getStorageSync("type"))var i=this.$api.change_user_info({token:this.token,gender:o});else i=this.$api.change_teacher_info({token:this.token,gender:o});i.then((function(e){n.getuserinfo()}))},set:function(e){this.newName=this.user_info.true_name,console.log("打开弹窗"),this.$refs.botpopup.open()}}};t.default=i}).call(this,n("543d")["default"])},"968e":function(e,t,n){"use strict";(function(e){n("f6c3"),n("921b");o(n("66fd"));var t=o(n("3a87"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},b210:function(e,t,n){"use strict";var o=n("0ec1"),i=n.n(o);i.a},f1fa:function(e,t,n){"use strict";n.r(t);var o=n("8a1f"),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a}},[["968e","common/runtime","common/vendor"]]]);