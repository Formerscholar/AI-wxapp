(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/myteaching/cropperPhoto"],{"00af":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=a("9ca6"),o=t.getSystemInfoSync(),s=o.screenWidth;console.log("SCREEN_WIDTH",s);o.pixelRatio;var n,i,r,u,h,p,l,g,f,d,m,v=1,b=100,y=o.screenWidth,T={data:function(){return{name:"chad",imageSrc:"",token:"",isphbox:!0,pic:"",flag:!0,isShowImg:!1,isWorH:!0,cropperInitW:s,cropperInitH:s,cropperW:s,cropperH:s,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:s,cutR:"100%",qualityWidth:y,innerAspectRadio:v,title:"",subject_name:"",RateXYZ:{x:0,y:0,z:0}}},onLoad:function(e){var a=e.ImagePath,c=e.textbook_id,o=e.choosePage,s=e.title,n=e.subject_name;console.log("onLoad",a),this.imageSrc=a,this.textbook_id=c,this.choosePage=o,this.title=s,this.subject_name=n,t.getStorageSync("userInfo").token&&(this.token=t.getStorageSync("userInfo").token)},onReady:function(){this.loadImage()},methods:{Gyroscopestart:function(){var e=this;t.startGyroscope({interval:"normal",success:function(){console.log("success")},fail:function(){console.log("fail")}}),t.onGyroscopeChange((function(t){var a=t.x,c=t.y,o=t.z;e.setData({RateXYZ:{x:a,y:c,z:o}}),console.log("gyroData.RateXYZ = ",e.RateXYZ),e.Gyroscopestop()}))},Gyroscopestop:function(){t.stopGyroscope({success:function(){console.log("stop success!")},fail:function(){console.log("stop fail!")}})},speedprogress:function(){var t=this;this.uploadTask.onProgressUpdate((function(e){console.log("上传进度"+e.progress),t.percent=e.progress}))},setData:function(t){var e=this;Object.keys(t).forEach((function(a){e.$set(e.$data,a,t[a])}))},getImage:function(){console.log("返回上个页面getImage"),t.navigateBack({delta:1})},loadImage:function(){var e=this;t.showLoading({title:"图片加载中..."}),t.getImageInfo({src:e.imageSrc,success:function(a){f=a.width/a.height,f>=1?(d=s,m=s/f):(d=s*f,m=s);var c=d>m?d:m;if(b=c>b?b:c,f>=1){var o=Math.ceil((s*f-s*f)/2)+25,n=o,i=0,r=i;e.setData({cropperW:s,cropperH:s/f,cropperL:Math.ceil((s-s)/2),cropperT:Math.ceil((s-s/f)/2),cutL:o,cutT:i,cutR:n,cutB:r,imageW:d,imageH:m,scaleP:d/s,qualityWidth:y,innerAspectRadio:f})}else{var u=Math.ceil((s*f-s*f)/2)+30,h=u,p=Math.ceil((s-b)/2)+30,l=p;e.setData({cropperW:s,cropperH:s/f,cropperL:Math.ceil((s-s*f)/2),cropperT:Math.ceil((s-s)/2),cutL:u,cutT:p,cutR:h,cutB:l,imageW:d,imageH:m,scaleP:d/s,qualityWidth:y,innerAspectRadio:f})}e.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){n=t.touches[0].pageX,i=t.touches[0].pageY},contentMoveing:function(t){var e=(n-t.touches[0].pageX)*v,a=(i-t.touches[0].pageY)*v;e>0?this.cutL-e<0&&(e=this.cutL):this.cutR+e<0&&(e=-this.cutR),a>0?this.cutT-a<0&&(a=this.cutT):this.cutB+a<0&&(a=-this.cutB),this.setData({cutL:this.cutL-e,cutT:this.cutT-a,cutR:this.cutR+e,cutB:this.cutB+a}),n=t.touches[0].pageX,i=t.touches[0].pageY},contentTouchEnd:function(){},search_exercises:function(){var e=this;this.$api.orc_one({textbook_id:this.textbook_id,pic:this.pic,token:this.token}).then((function(a){console.log("res",a);var c=a.result;console.log("result",c),200==a.code?1==a.data.data.length?t.redirectTo({url:"/pages/knowledgeBase/watchExplane?id="+a.data.data[0].exercises_id+"&source=1"}):t.redirectTo({url:"/pages/myPaper/seePapers?status=photo&listData="+encodeURIComponent(JSON.stringify(a.data.data))+"&title="+e.title+"&subject_name="+e.subject_name+"&source=1"}):t.showToast({title:a.msg,icon:"none"}),e.flag=!1,e.percent=0,e.iscmdProgress=!1}))},base64:function(e){var a=e.url,c=e.type;return new Promise((function(e,o){t.getFileSystemManager().readFile({filePath:a,encoding:"base64",success:function(t){e("data:image/"+c.toLocaleLowerCase()+";base64,"+t.data)},fail:function(t){return o(t.errMsg)}})}))},getImageInfo:function(){var e=this,a=this;t.showLoading({title:"图片生成中..."});var o=t.createCanvasContext("myCanvas");o.drawImage(a.imageSrc,0,0,d,m),o.draw(!1,(function(){var o=(a.cropperW-a.cutL-a.cutR)/a.cropperW*d,s=(a.cropperH-a.cutT-a.cutB)/a.cropperH*m,n=a.cutL/a.cropperW*d,i=a.cutT/a.cropperH*m,r=o/s;console.log("numResul",r),e.isWorH=!(r<1),t.canvasToTempFilePath({x:n,y:i,width:o,height:s,destWidth:4*o,destHeight:4*s,fileType:"png",quality:1,canvasId:"myCanvas",success:function(a){t.hideLoading(),(0,c.pathToBase64)(a.tempFilePath).then((function(t){console.log(t),e.isphbox=!1,e.flag=!0,e.pic=t,e.search_exercises()})).catch((function(e){console.error(e),t.showToast({title:"上传图片失败",icon:"none"}),t.navigateBack()}))}})}))},dragStart:function(t){r=t.touches[0].pageX,u=t.touches[0].pageY,h=this.cutL,l=this.cutR,g=this.cutB,p=this.cutT},dragMove:function(t){var e=t.target.dataset.drag;switch(e){case"right":var a=(r-t.touches[0].pageX)*v;l+a<0&&(a=-l),this.setData({cutR:l+a});break;case"left":a=(r-t.touches[0].pageX)*v;h-a<0&&(a=h),h-a>this.cropperW-this.cutR&&(a=h-(this.cropperW-this.cutR)),this.setData({cutL:h-a});break;case"top":a=(u-t.touches[0].pageY)*v;p-a<0&&(a=p),p-a>this.cropperH-this.cutB&&(a=p-(this.cropperH-this.cutB)),this.setData({cutT:p-a});break;case"bottom":a=(u-t.touches[0].pageY)*v;g+a<0&&(a=-g),this.setData({cutB:g+a});break;case"rightBottom":var c=(r-t.touches[0].pageX)*v,o=(u-t.touches[0].pageY)*v;g+o<0&&(o=-g),l+c<0&&(c=-l);var s=g+o,n=l+c;this.setData({cutB:s,cutR:n});break;default:break}}}};e.default=T}).call(this,a("543d")["default"])},"0ba8":function(t,e,a){"use strict";(function(t){a("f6c3"),a("921b");c(a("66fd"));var e=c(a("6ffa"));function c(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},"100e":function(t,e,a){"use strict";a.r(e);var c=a("00af"),o=a.n(c);for(var s in c)"default"!==s&&function(t){a.d(e,t,(function(){return c[t]}))}(s);e["default"]=o.a},"438e":function(t,e,a){"use strict";var c;a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return c}));var o=function(){var t=this,e=t.$createElement;t._self._c},s=[]},5551:function(t,e,a){"use strict";var c=a("d8d4"),o=a.n(c);o.a},"6ffa":function(t,e,a){"use strict";a.r(e);var c=a("438e"),o=a("100e");for(var s in o)"default"!==s&&function(t){a.d(e,t,(function(){return o[t]}))}(s);a("5551");var n,i=a("f0c5"),r=Object(i["a"])(o["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],n);e["default"]=r.exports},d8d4:function(t,e,a){}},[["0ba8","common/runtime","common/vendor"]]]);