(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/myteaching/cropperPhoto"],{"002b":function(t,e,a){"use strict";a.r(e);var c=a("4126"),o=a("ed64");for(var s in o)"default"!==s&&function(t){a.d(e,t,(function(){return o[t]}))}(s);a("96f9");var i,n=a("f0c5"),r=Object(n["a"])(o["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],i);e["default"]=r.exports},4126:function(t,e,a){"use strict";var c;a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return c}));var o=function(){var t=this,e=t.$createElement;t._self._c},s=[]},"7b67":function(t,e,a){},"96f9":function(t,e,a){"use strict";var c=a("7b67"),o=a.n(c);o.a},a5a9:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=t.getSystemInfoSync(),c=a.screenWidth;console.log("SCREEN_WIDTH",c);a.pixelRatio;var o,s,i,n,r,u,h,p,l,g,f,d=1,m=100,v=a.screenWidth,b={data:function(){return{name:"chad",imageSrc:"",token:"",isphbox:!0,pic:"",flag:!0,isShowImg:!1,isWorH:!0,cropperInitW:c,cropperInitH:c,cropperW:c,cropperH:c,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:c,cutR:"100%",qualityWidth:v,innerAspectRadio:d,title:"",subject_name:"",RateXYZ:{x:0,y:0,z:0}}},onLoad:function(e){var a=e.ImagePath,c=e.textbook_id,o=e.choosePage,s=e.title,i=e.subject_name;console.log("onLoad",a),this.imageSrc=a,this.textbook_id=c,this.choosePage=o,this.title=s,this.subject_name=i,t.getStorageSync("userInfo").token&&(this.token=t.getStorageSync("userInfo").token)},onReady:function(){this.loadImage()},methods:{Gyroscopestart:function(){var e=this;t.startGyroscope({interval:"normal",success:function(){console.log("success")},fail:function(){console.log("fail")}}),t.onGyroscopeChange((function(t){var a=t.x,c=t.y,o=t.z;e.setData({RateXYZ:{x:a,y:c,z:o}}),console.log("gyroData.RateXYZ = ",e.RateXYZ),e.Gyroscopestop()}))},Gyroscopestop:function(){t.stopGyroscope({success:function(){console.log("stop success!")},fail:function(){console.log("stop fail!")}})},speedprogress:function(){var t=this;this.uploadTask.onProgressUpdate((function(e){console.log("上传进度"+e.progress),t.percent=e.progress}))},setData:function(t){var e=this;Object.keys(t).forEach((function(a){e.$set(e.$data,a,t[a])}))},getImage:function(){console.log("返回上个页面getImage"),this.Gyroscopestop(),t.navigateBack({delta:1})},loadImage:function(){var e=this;t.showLoading({title:"图片加载中..."}),t.getImageInfo({src:e.imageSrc,success:function(a){l=a.width/a.height,l>=1?(g=c,f=c/l):(g=c*l,f=c);var o=g>f?g:f;if(m=o>m?m:o,l>=1){var s=Math.ceil((c*l-c*l)/2)+25,i=s,n=0,r=n;e.setData({cropperW:c,cropperH:c/l,cropperL:Math.ceil((c-c)/2),cropperT:Math.ceil((c-c/l)/2),cutL:s,cutT:n,cutR:i,cutB:r,imageW:g,imageH:f,scaleP:g/c,qualityWidth:v,innerAspectRadio:l})}else{var u=Math.ceil((c*l-c*l)/2)+30,h=u,p=Math.ceil((c-m)/2)+30,d=p;e.setData({cropperW:c,cropperH:c/l,cropperL:Math.ceil((c-c*l)/2),cropperT:Math.ceil((c-c)/2),cutL:u,cutT:p,cutR:h,cutB:d,imageW:g,imageH:f,scaleP:g/c,qualityWidth:v,innerAspectRadio:l})}e.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){o=t.touches[0].pageX,s=t.touches[0].pageY},contentMoveing:function(t){var e=(o-t.touches[0].pageX)*d,a=(s-t.touches[0].pageY)*d;e>0?this.cutL-e<0&&(e=this.cutL):this.cutR+e<0&&(e=-this.cutR),a>0?this.cutT-a<0&&(a=this.cutT):this.cutB+a<0&&(a=-this.cutB),this.setData({cutL:this.cutL-e,cutT:this.cutT-a,cutR:this.cutR+e,cutB:this.cutB+a}),o=t.touches[0].pageX,s=t.touches[0].pageY},contentTouchEnd:function(){},search_exercises:function(){var e=this;this.$api.orc_one({textbook_id:this.textbook_id,pic:this.pic,token:this.token}).then((function(a){console.log("res",a);var c=a.result;console.log("result",c),200==a.code?1==a.data.data.length?t.redirectTo({url:"/pages/knowledgeBase/watchExplane?id="+a.data.data[0].exercises_id}):t.redirectTo({url:"/pages/myPaper/seePapers?status=photo&listData="+encodeURIComponent(JSON.stringify(a.data.data))+"&title="+e.title+"&subject_name="+e.subject_name}):t.showToast({title:a.msg,icon:"none"}),e.flag=!1,e.percent=0,e.iscmdProgress=!1}))},base64:function(e){var a=e.url,c=e.type;return new Promise((function(e,o){t.getFileSystemManager().readFile({filePath:a,encoding:"base64",success:function(t){e("data:image/"+c.toLocaleLowerCase()+";base64,"+t.data)},fail:function(t){return o(t.errMsg)}})}))},getImageInfo:function(){var e=this;this.Gyroscopestart(),console.log("RateXYZ = ",this.RateXYZ);var a=this;t.showLoading({title:"图片生成中..."});var c=t.createCanvasContext("myCanvas");c.drawImage(a.imageSrc,0,0,g,f),c.draw(!1,(function(){var c=(a.cropperW-a.cutL-a.cutR)/a.cropperW*g,o=(a.cropperH-a.cutT-a.cutB)/a.cropperH*f,s=a.cutL/a.cropperW*g,i=a.cutT/a.cropperH*f,n=c/o;console.log("numResul",n),e.isWorH=!(n<1),t.canvasToTempFilePath({x:s,y:i,width:c,height:o,destWidth:4*c,destHeight:4*o,fileType:"png",quality:1,canvasId:"myCanvas",success:function(a){t.hideLoading(),e.pic=a.tempFilePath,e.base64({url:e.pic,type:"png"}).then((function(t){console.log("canvasToTempFilePath",t),e.isphbox=!1,e.flag=!0,e.pic=t,e.search_exercises()})).catch((function(e){t.showToast({title:"上传图片失败",icon:"none"}),t.navigateBack()}))}})}))},dragStart:function(t){i=t.touches[0].pageX,n=t.touches[0].pageY,r=this.cutL,h=this.cutR,p=this.cutB,u=this.cutT},dragMove:function(t){var e=t.target.dataset.drag;switch(e){case"right":var a=(i-t.touches[0].pageX)*d;h+a<0&&(a=-h),this.setData({cutR:h+a});break;case"left":a=(i-t.touches[0].pageX)*d;r-a<0&&(a=r),r-a>this.cropperW-this.cutR&&(a=r-(this.cropperW-this.cutR)),this.setData({cutL:r-a});break;case"top":a=(n-t.touches[0].pageY)*d;u-a<0&&(a=u),u-a>this.cropperH-this.cutB&&(a=u-(this.cropperH-this.cutB)),this.setData({cutT:u-a});break;case"bottom":a=(n-t.touches[0].pageY)*d;p+a<0&&(a=-p),this.setData({cutB:p+a});break;case"rightBottom":var c=(i-t.touches[0].pageX)*d,o=(n-t.touches[0].pageY)*d;p+o<0&&(o=-p),h+c<0&&(c=-h);var s=p+o,l=h+c;this.setData({cutB:s,cutR:l});break;default:break}}}};e.default=b}).call(this,a("543d")["default"])},ed64:function(t,e,a){"use strict";a.r(e);var c=a("a5a9"),o=a.n(c);for(var s in c)"default"!==s&&function(t){a.d(e,t,(function(){return c[t]}))}(s);e["default"]=o.a},f8c4:function(t,e,a){"use strict";(function(t){a("022d"),a("921b");c(a("66fd"));var e=c(a("002b"));function c(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])}},[["f8c4","common/runtime","common/vendor"]]]);